<ForceField>
    <AtomTypes>
        <Type name="MBPol-O" class="O" element="O" mass="15.99943"/>
        <Type name="MBPol-H" class="H" element="H" mass="1.007947"/>
        <Type name="MBPol-M" class="M" mass="0"/>
        <Type name="MBPol-Li" class="Li" element="Li" mass="6.941"/>
        <Type name="MBPol-Na" class="Na" element="Na" mass="22.989769"/>
        <Type name="MBPol-F" class="F" element="F" mass="18.998403"/>
        <Type name="MBPol-Cl" class="CL" element="Cl" mass="35.453200"/>
        <Type name="MBPol-Br" class="Br" element="Br" mass="79.904"/>
        <Type name="MBPol-I" class="I" element="I" mass="126.90447"/>
    </AtomTypes>
    <Residues>
        <Residue name="HOH">
            <Atom name="O" type="MBPol-O" />
            <Atom name="H1" type="MBPol-H" />
            <Atom name="H2" type="MBPol-H" />
            <Atom name="M" type="MBPol-M" />
            <VirtualSite type="average3" index="3" atom1="0" atom2="1" atom3="2" weight1="0.573293118" weight2="0.213353441" weight3="0.213353441" />
            <Bond from="0" to="1" />
            <Bond from="0" to="2" />
        </Residue>
        <Residue name="Li">
            <Atom name="Li" type="MBPol-Li" />
        </Residue>
        <Residue name="Na">
            <Atom name="Na" type="MBPol-Na" />
        </Residue>
        <Residue name="F">
            <Atom name="F" type="MBPol-F" />
        </Residue>
        <Residue name="CL">
            <Atom name="Cl" type="MBPol-Cl" />
        </Residue>
        <Residue name="Br">
            <Atom name="Br" type="MBPol-Br" />
        </Residue>
        <Residue name="I">
            <Atom name="I" type="MBPol-I" />
        </Residue>
    </Residues>
    <Script>
numAtomClasses = 7

typeToClass = {
  'MBPol-O':0,
  'MBPol-H':0,
  'MBPol-M':0,
  'MBPol-Li':1, 
  'MBPol-Na':2,
  'MBPol-F':3,
  'MBPol-Cl':4,
  'MBPol-Br':5,
  'MBPol-I':6,
}

Atable = [
#   H2O       Li       Na        F       Cl       Br        I   
      0,   32318, 47827.7, 35920.3, 50180.4, 37682.2,   22210,  #H20 
  32318, 26110.8,       0, 18959.5, 27202.5,   27815, 36470.8,  # Li
47827.7,       0,  134244, 37835.8, 26832.4, 26310.6, 31172.4,  # Na
35920.3, 31172.4, 37835.8, 1687.14,       0,       0,       0,  #  F
50180.4, 27202.5, 26832.4,       0, 3246.54,       0,       0,  # Cl
37682.2,   27815, 26310.6,       0,       0, 3674.06,       0,  # Br
  22210, 36470.8, 31172.4,       0,       0,       0, 6672.41,  #  I
]

btable = [
#   H2O       Li       Na        F       Cl       Br        I   
      0, 4.02327, 3.76951, 3.58619, 3.27542, 3.05825, 2.72314,  #H20 
4.02327, 6.63418,       0, 3.33069, 2.97021, 2.76135, 2.70532,  # Li
3.76951,       0, 5.17793, 3.52363, 2.69336,  2.5252,  2.4457,  # Na
3.58619, 3.33069, 3.52363, 3.52363,       0,       0,       0,  #  F
3.27542, 2.97021, 2.69336,       0, 1.86699,       0,       0,  # Cl
3.05825, 2.76135,  2.5252,       0,       0, 1.79922,       0,  # Br
2.72314, 2.70532,  2.4457,       0,       0,       0, 1.79453,  #  I
]

customNonbondedForce = mm.CustomNonbondedForce("A * exp(-b*r); A=Atable(type1, type2); b=btable(type1, type2)")

customNonbondedForce.setNonbondedMethod(0)
customNonbondedForce.setCutoffDistance(nonbondedCutoff)
customNonbondedForce.addTabulatedFunction('Atable', mm.Discrete2DFunction(numAtomClasses, numAtomClasses, Atable))
customNonbondedForce.addTabulatedFunction('btable', mm.Discrete2DFunction(numAtomClasses, numAtomClasses, btable))
customNonbondedForce.addPerParticleParameter('type')

for atom in data.atoms:
     customNonbondedForce.addParticle([typeToClass[data.atomType[atom]]])

sys.addForce(customNonbondedForce)
    </Script>
</ForceField>
